# Fluent Bit: логи контейнеров Docker (vodeneevbet-*) → Yandex Cloud Logging.
# VM в другом аккаунте Yandex Cloud: используй authorization iam-key-file и folder_id (см. ниже).

[SERVICE]
    Flush        5
    Daemon       Off
    Log_Level    info
    Plugins_File /etc/fluent-bit/plugins.conf
    Parsers_File /etc/fluent-bit/parsers-docker.conf

[INPUT]
    Name              tail
    Tag               docker.*
    Path              /var/lib/docker/containers/*/*-json.log
    Parser            docker
    DB                /var/log/fluent-bit-docker.db
    Mem_Buf_Limit     5MB
    Skip_Long_Lines   On
    Refresh_Interval  10

# Вариант 1: VM в том же аккаунте, что и лог-группа — сервисный аккаунт привязан к VM.
# [OUTPUT]
#     Name            yc-logging
#     Match           *
#     resource_type   bookmaker-vm
#     message_key     log
#     level_key       stream
#     default_level   INFO
#     authorization   instance-service-account

# Вариант 2: VM в другом аккаунте Yandex Cloud — ключ сервисного аккаунта из аккаунта с лог-группой.
# Создай ключ: yc iam key create --service-account-name <имя> --output key.json
# Положи key.json на VM (например /opt/vodeneevbet/bookmaker-services/yc-logging-key.json), chmod 600.
# folder_id — каталог, где лог-группа (тот же, что у parser/core).
# group_id — ID лог-группы (ВАЖНО: рекомендуется указать явно, иначе плагин может падать).
#   Получить ID: yc logging group list --folder-id=b1g7tng74uda3ahpg6oi
#   Или из GitHub Secrets: YC_LOG_GROUP_ID
[OUTPUT]
    Name            yc-logging
    Match           *
    resource_type   bookmaker-vm
    folder_id       b1g7tng74uda3ahpg6oi
    group_id        e23b2rtnehi7p58oskor
    message_key     log
    level_key       stream
    default_level   INFO
    authorization   iam-key-file:/opt/vodeneevbet/bookmaker-services/yc-logging-key.json
